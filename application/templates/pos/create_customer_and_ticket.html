<form action="" method="post">
    <div class="row">
        <div class="col-lg-12"><button class="btn btn-link pull-right" id="CloseScreenCreateTicket">X</button></div>
        <div class="col-lg-4">
            <div class="panel panel-info panel-pos">
              <div class="panel-heading text-center"><h4>Customer Information</h4></div>
              <div class="panel-body">
                  {{ form.hidden_tag() }}
                <div class="form-group">
                    <label>{{ form.first_name.label }} :</label>
                    {{ form.first_name(class_='form-control')|safe }}
                    {% for message in form.first_name.errors %}
                        <span class="help-block text-danger">{{ message }}</span>
                      {% endfor %}
                </div>
                <div class="form-group">
                    <label>{{ form.last_name.label }} :</label>
                    {{ form.last_name(class_='form-control')|safe }}
                    {% for message in form.last_name.errors %}
                        <span class="help-block text-danger">{{ message }}</span>
                      {% endfor %}
                </div>
                <div class="form-group">
                    <label>{{ form.birthday.label }} :</label>
                    {{ form.birthday(class_='form-control', id="datepickerbirth")|safe }}
                    {% for message in form.birthday.errors %}
                        <span class="help-block text-danger">{{ message }}</span>
                      {% endfor %}
                </div>
                  <div class="form-group">
                    <label>{{ form.profession.label }} :</label>
                    {{ form.profession(class_='form-control')|safe }}
                </div>
                  <div class="form-group">
                    <label>{{ form.nationality.label }} :</label>
                    <select name="nationality" id="" class="form-control g-select input-lg">
                        <option value="">{{ form.nationality.label }}</option>
                        {% for key, val in nationalList.items() %}
                            <option value="{{ key }}" {% if form.nationality.data == key %} selected {% endif %}>{{ val }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>{{ form.phone.label }} :</label>
                    {{ form.phone(class_='form-control')|safe }}
                </div>
                <div class="form-group">
                    <label>{{ form.email.label }} :</label>
                    {{ form.email(class_='form-control')|safe }}
                </div>

              </div>
            </div>
        </div>
        <div class="col-lg-4">

            <div class="panel panel-info panel-pos">
              <div class="panel-heading text-center"><h4>Ticket Type</h4></div>
              <div class="panel-body text-center">
                  <div class="alert alert-danger" id="alert"> </div>
                  <div class="row">
                      {% for type_name in ticket_type_name %}
                          {% if not type_name.special and not type_name.is_child %}
                              <div class="col-lg-6">
                                    <div class="radio">
                                      <label>
                                        <input type="radio" name="type_name" class="TicketTypeName" value="{{ type_name.key.id() }}" {% if type_name.default %} checked {% endif %}>
                                        {{ type_name.name }}
                                      </label>
                                    </div>
                              </div>
                          {% endif %}
                      {% endfor %}
                      <div class="col-lg-12">
                            <div class="radio">
                                <div class="">
                                    <div class="col-lg-1">
                                        <label>
                                            <input type="radio" name="type_name" value="" class="CheckBox-Select">
                                        </label>
                                    </div>
                                    <div class="col-lg-10">
                                      <select name="type_name_select" id="CheckBox-Select" class="form-control"  disabled="disabled">
                                          {% for type_name in ticket_type_name %}
                                              {% if type_name.special %}
                                                  <option value="{{ type_name.key.id() }}">{{ type_name.name }}</option>
                                              {% endif %}
                                          {% endfor %}
                                      </select>
                                    </div>
                                </div>
                            </div>
                      </div>
                  </div>

                  <hr/>
                    <div class="row">
                        {% for class in class_ticket %}
                                  <div class="col-lg-6">
                                        <div class="radio">
                                          <label>
                                            <input type="radio" name="class_name" class="ClassTicket" value="{{ class.key.id() }}" {% if class.default %} checked {% endif %}>
                                            {{ class.name }}
                                          </label>
                                        </div>
                                  </div>
                        {% endfor %}
                    </div>
                  <hr/>
                  <div class="row">
                      {% for journey in journey_ticket %}
                          <div class="col-lg-6">
                                <div class="radio">
                                  <label>
                                    <input type="radio" name="journey_name" class="JourneyTicket" value="{{ journey.key.id() }}" {% if journey.default %} checked {% endif %}>
                                    {{ journey.name }}
                                  </label>
                                </div>
                          </div>
                      {% endfor %}
                  </div>






              </div>
            </div>

        </div>
        <div class="col-lg-4">
            <div class="text-center well">
              <h1 style="margin:0;">
                      <span class="text-muted" id="TicketPrice">
                      </span>
                      <span class="text-primary" id="TicketCurrency">
                      </span>
              </h1>
            </div>
        </div>
    </div>
</form>
<script>
    $('#datepickerbirth').inputmask("date", { placeholder:"__/__/____"});

    $("select.g-select").each(function() {
        var e = $(this);
        e.select2()
    });

    $('#CloseScreenCreateTicket').click(function(e) {
            e.preventDefault();
            $('#ScreenIndexPos').show();
            $('#ScreenCreateTicket').addClass('hidden').html('');
    });


    /*---------------------------------

     Traitement de l'affichage du prix

     ----------------------------------*/

    /* Prix au chargement */
    var data = {};
    data['type_name'] =  $('input:checked.TicketTypeName').val();
    data['class_name'] = $('input:checked.ClassTicket').val();
    data['journey_name'] = $('input:checked.JourneyTicket').val();
    AjaxPrice(data);



    $(document).ready(function(e){
        $('input.TicketTypeName, input.ClassTicket, input.JourneyTicket, input.CheckBox-Select').on('change', function(){

            data['type_name'] =  $('input:checked.TicketTypeName').val();
            data['class_name'] = $('input:checked.ClassTicket').val();
            data['journey_name'] = $('input:checked.JourneyTicket').val();

            var InputCheckbox = $('input.CheckBox-Select');
            var SelectCheckbox = $('#CheckBox-Select');

            if (InputCheckbox.is(':checked')){
                SelectCheckbox.removeAttr('disabled');
                selectVal = SelectCheckbox.val();
                InputCheckbox.val(selectVal);
                data['type_name'] =  $('input.CheckBox-Select').val();
            }else{
                SelectCheckbox.attr({disabled:'disabled'});
            }
            AjaxPrice(data);
        });

        $('#CheckBox-Select').on('change', function(){

            selecVal  = $(this).val();
            $('input.CheckBox-Select').val(selecVal);

            data['class_name'] = $('input:checked.ClassTicket').val();
            data['journey_name'] = $('input:checked.JourneyTicket').val();
            data['type_name'] =  $('input.CheckBox-Select').val();
            AjaxPrice(data);
        });

    });

    function AjaxPrice(datas){
        url = "{{ url_for('Search_Ticket_Type') }}";
        $.ajax({
            url: url,
            type: 'POST',
            data: JSON.stringify(datas),
            contentType: 'application/json;charset=UTF-8',
            dataType: "json",
            success: function(data) {
                if (data['statut'] == 'OK'){
                    $('#TicketPrice').text(data['price']);
                    $('#TicketCurrency').text(data['currency']);

                }else{
                    $('#TicketPrice').text(data['value']);
                    $('#TicketCurrency').text('');
                }
                console.log(data['notticket']);
                if(data['notticket'] == 'true'){
                    $("#alert").show();
                    $("#alert").text('You don\'t have this ticket type. Contact Administrator');
                }else{
                    $("#alert").hide().empty();
                }
            }
        });
    }







</script>